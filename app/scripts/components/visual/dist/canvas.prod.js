"use strict";function ownKeys(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),i.push.apply(i,s)}return i}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(i,!0).forEach(function(t){_defineProperty(e,t,i[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):ownKeys(i).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))})}return e}function _defineProperty(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}function _createClass(t,e,i){return e&&_defineProperties(t.prototype,e),i&&_defineProperties(t,i),t}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var Canvas=function(){function n(t,e,i,s){_classCallCheck(this,n),this.el=document.getElementById(t),this.ctx=this.el.getContext("2d"),this.ctx.mozImageSmoothingEnabled=!1,this.ctx.webkitImageSmoothingEnabled=!1,this.ctx.msImageSmoothingEnabled=!1,this.ctx.imageSmoothingEnabled=!1,this.w=this.el.width=e,this.h=this.el.height=i,this.size=s,this.countBlocks=this.w/this.size*(this.h/this.size),this.timeOut=!1,this.x=0,this.y=0,this.tps=100,this.frame=0,this.countBegin=0}return _createClass(n,[{key:"resize",value:function(t,e){this.w=this.el.width=t,this.h=this.el.height=e,this.countBlocks=this.w/this.size*(this.h/this.size),this.ctx=this.el.getContext("2d")}},{key:"drawImg",value:function(t,e,i){var s=this,n=new Image;n.onload=function(){s.resize(n.naturalWidth,n.naturalHeight),s.ctx.drawImage(n,0,0),e()};var a=t.split("?")[0];n.src=a+"?"+(new Date).getTime(),n.setAttribute("crossOrigin",""),n.onerror=function(t){i(t)}}},{key:"drawData",value:function(t){var i=this,s=0,n=0;t.forEach(function(t,e){s=e%i.size,n=parseInt(e/i.size),i.ctx.beginPath(),i.ctx.rect(20*s,20*n,20,20),i.ctx.fillStyle="rgb("+255*(1-t)+","+255*(1-t)+","+255*(1-t)+")",i.ctx.fill()})}},{key:"drawLine",value:function(t,e,i,s){var n=_objectSpread({delta:1,limit:.5},s),a=t[1]>n.limit,r=t[0]>n.limit;this.ctx.beginPath();var h=e*this.size,o=i*this.size;r&&(this.ctx.moveTo(h,o+n.delta),this.ctx.lineTo(h+this.size*n.delta,o+n.delta)),a&&(this.ctx.moveTo(h+n.delta,o),this.ctx.lineTo(h+n.delta,o+this.size*n.delta)),this.ctx.strokeStyle="#333333",this.ctx.strokeWidth=1,this.ctx.stroke(),this.ctx.closePath()}},{key:"clear",value:function(){this.ctx.clearRect(0,0,this.w,this.h)}},{key:"getData",value:function(){for(var t=this.ctx.getImageData(this.x,this.y,this.size,this.size),e=[],i=0;i<this.size;i++)for(var s=0;s<this.size;s++){var n=4*(s+i*this.size),a=.3*t.data[n]+.59*t.data[1+n]+.11*t.data[2+n];e.push((a-126)/126)}return e}},{key:"nextPos",value:function(){return this.y+=this.size,this.y>=this.h&&(this.x+=this.size,this.y=0),!(this.x>=this.w)||(this.x=0,this.y=0,!1)}},{key:"nextRandPos",value:function(){this.x=this.w*Math.random(),this.y=this.h*Math.random(),this.x=this.x-this.x%this.size,this.y=this.y-this.y%this.size}},{key:"each",value:function(n,a){var r=this;this.promise=new Promise(function(t,e){r.pause?r.pauseContent=function(){t(r.getData())}:t(r.getData())}).then(function(t){var e=r.x/r.size,i=r.y/r.size,s=(e*r.h/r.size+i)/r.countBlocks*100;n(t,e,i,s),r.nextPos()?(r.frame++,r.frame==r.tps?(r.frame=0,setTimeout(function(){r.each(n,a)},0)):r.each(n,a)):(r.x=0,r.y=0,a())})}},{key:"eachRand",value:function(n,a,r){var h=this;this.countBegin<n&&(this.countBegin=n),this.promise=new Promise(function(t,e){h.pause?h.pauseContent=function(){t(h.getData())}:t(h.getData())}).then(function(t){var e=h.x/h.size,i=h.y/h.size,s=100*(1-n/h.countBegin);a(t,e,i,s),0<n?(h.nextRandPos(),h.frame++,h.frame==h.tps?(h.frame=0,setTimeout(function(){h.eachRand(n-1,a,r)},0)):h.eachRand(n-1,a,r)):(r(),h.countBegin=0,h.x=0,h.y=h.size)})}}]),n}(),_default=Canvas;exports.default=_default;