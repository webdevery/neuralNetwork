"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _jquery=_interopRequireDefault(require("jquery")),_controller=_interopRequireDefault(require("./brain/controller.js")),_canvas=_interopRequireDefault(require("./visual/canvas.js")),_textContent=_interopRequireDefault(require("./visual/textContent.js"));function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _classCallCheck(e,a){if(!(e instanceof a))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,a){for(var t=0;t<a.length;t++){var r=a[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass(e,a,t){return a&&_defineProperties(e.prototype,a),t&&_defineProperties(e,t),e}var MainController=function(){function e(){_classCallCheck(this,e),this.opts={sizeBox:3,kSize:20,values:[[1,.02],[.02,1],[1,1],[.02,.02]],brain:{layers:[9,36,18,2],offset:!0},stepEra:1e3},this.errorsEra=0,this.iteration=0,this.texts=[],this.init()}return _createClass(e,[{key:"init",value:function(){this.NeuralNetwork=new _controller.default(this.opts.brain),this.mainCanvas=new _canvas.default("main",1,1,this.opts.sizeBox),this.previewCanvas=new _canvas.default("sub",this.opts.sizeBox*this.opts.kSize,this.opts.sizeBox*this.opts.kSize,this.opts.sizeBox),this.resultCanvas=new _canvas.default("result",1,1,this.opts.sizeBox),this.texts.awaitResult=new _textContent.default("awaitResult",{around:!0}),this.texts.error=new _textContent.default("error",{around:!0}),this.texts.errorsEra=new _textContent.default("errorsEra",{around:!0}),this.texts.progress=new _textContent.default("progress",{prefix:"%",around:!0}),this.start()}},{key:"start",value:function(){this.events()}},{key:"updateScreen",value:function(e){this.iteration++,e.res&&this.texts.awaitResult.update(e.res),e.progress&&this.texts.progress.update(e.progress),e.error&&(this.texts.error.update(e.error),this.errorsEra+=e.error),e.data&&this.previewCanvas.drawData(e.data),this.iteration>=this.opts.stepEra&&(this.texts.errorsEra.update(this.errorsEra),this.iteration=0,this.errorsEra=0)}},{key:"load",value:function(t,e){var r=this,n=t.split(".")[t.split(".").length-1];"json"==n||(n="img"),console.log(n),this.loader=new Promise(function(e,a){"json"===n?r.NeuralNetwork.load(t,e,a):r.mainCanvas.drawImg(t,e,a)}).then(function(){e()}).catch(function(e){alert("Ошибка загрузки, Это может быть связано с тем, что вы указали неверный URL или у вас нет доступа к ресурсу",e)})}},{key:"startLearn",value:function(e,a){var t=this;this.load(a,function(){t.learning(e)})}},{key:"learning",value:function(e){var i=this;this.proccessBegin();this.mainCanvas.eachRand(e,function(e,a,t,r){var n=function(e,a){var t=a*(i.mainCanvas.w/i.opts.sizeBox)+e;return i.opts.values[t%i.opts.values.length]}(a,t),s=i.NeuralNetwork.learn(e,n);i.updateScreen({data:e,res:n,progress:r,error:s}),i.NeuralNetwork.learned=!0},function(){i.proccessEnd(),console.log("COMPLETE LEARN");var e=document.getElementById("download");i.NeuralNetwork.save(e)})}},{key:"startRead",value:function(e,a){var t=this;this.load(e,function(){t.resultCanvas.resize(t.mainCanvas.w,t.mainCanvas.h),t.NeuralNetwork.learned?t.reading(a):t.load("./data/3-10-2.json",function(){t.reading(a)})})}},{key:"reading",value:function(s){var i=this;this.proccessBegin(),this.mainCanvas.timeOut=!0,this.mainCanvas.each(function(e,a,t,r){var n=i.NeuralNetwork.read(e);i.updateScreen({data:e,res:n,progress:r,error:0}),i.resultCanvas.drawLine(n,a,t,s)},function(){i.proccessEnd(),console.log("COMPLETE READ")})}},{key:"proccessBegin",value:function(){this.NeuralNetwork.procces=!0,this.mainCanvas.pause=!1,this.mainCanvas.pauseContent=null,(0,_jquery.default)("#pause").removeClass("disabled"),(0,_jquery.default)("#stop").removeClass("disabled")}},{key:"proccessEnd",value:function(){this.NeuralNetwork.procces=!1,this.mainCanvas.pause=!1,this.mainCanvas.pauseContent=null,(0,_jquery.default)("#pause").addClass("disabled"),(0,_jquery.default)("#stop").addClass("disabled")}},{key:"proccessKill",value:function(){this.proccessEnd()}},{key:"events",value:function(){var r=this;(0,_jquery.default)("#learn").submit(function(e){e.preventDefault();var a=(0,_jquery.default)("#learn").find("[name=count]").val(),t=(0,_jquery.default)("#learn").find("[name=url_data]").val();a=parseInt(a),r.NeuralNetwork.procces||r.startLearn(a,t)}),(0,_jquery.default)("#read").submit(function(e){e.preventDefault();var a=(0,_jquery.default)("#read").find("[name=url]").val(),t={delta:parseFloat((0,_jquery.default)("#read").find("[name=delta]").val()),limit:parseFloat((0,_jquery.default)("#read").find("[name=limit]").val())/100};r.NeuralNetwork.procces||r.startRead(a,t)}),(0,_jquery.default)("#pause").click(function(e){r.mainCanvas.pause?(r.mainCanvas.pause=!1,r.mainCanvas.pauseContent(),r.mainCanvas.pauseContent=null,(0,_jquery.default)("#pause").text("Приостановить")):(r.mainCanvas.pause=!0,(0,_jquery.default)("#pause").text("Продолжить"))}),(0,_jquery.default)("#stop").click(function(e){r.mainCanvas.pause=!0,setTimeout(function(){r.mainCanvas.pause=!1,r.mainCanvas.pauseContent=null,r.proccessKill()},300)}),(0,_jquery.default)("[data-read] img").click(function(e){var a=e.target;(0,_jquery.default)("#read").find("[name=url]").val(a.src)}),(0,_jquery.default)("[data-learn] img").click(function(e){var a=e.target;(0,_jquery.default)("#learn").find("[name=url_data]").val(a.src)})}}]),e}(),_default=MainController;exports.default=_default;